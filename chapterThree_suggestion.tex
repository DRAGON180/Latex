% !TeX root=thesis.tex
%\فصل{روش پیشنهادی}\برچسب{فصل‌پیشنهاد}\صفحه‌جدید\صفحه‌پاک
\mychapter{3}{فصل سوم: روش پیشنهادی}\label{فصل‌پیشنهاد}
%\chapter[فصل سوم: روش پیشنهادی]{روش پیشنهادی}\label{فصل‌پیشنهاد}
\قسمت{مقدمه}
 بهبود و حفظ کیفیت سرویس یکی از موضوعات مهم در زمینه سیستم‌های رایانش ابری است. برای این منظور، نیاز است تا برنامه‌ریزی‌های مختلف و سیاست‌های متفاوتی در زمینه مدیریت این سیستم‌ها در نظر گرفته شود تا بتوانیم با مدیریت مناسب منابع از افزایش مصرف انرژی  و نقض شدن کیفیت سرویس جلوگیری کنیم. اگر مدیریت مناسب و روش‌های مناسبی در جای‌دهی ماشین‌های مجازی به ماشین‌های فیزیکی صورت گیرد می‌توانیم در بهبود کیفیت سرویس و انرژی مصرفی تاثیر بگذاریم. سوالاتی که قصد داریم  در این تحقیق به آن‌ها بپردازیم به شرح زیر است:
 \شروع{فقرات}
\فقره به چه نحوی می‌توانیم جای دهی مناسبی از ماشین‌های مجازی روی ماشین‌های فیزیکی فراهم آوریم؟
\فقره به چه نحوی در استفاده مناسب از منابع ماشین‌های فیزیکی تاثیر می‌گذاریم؟
\فقره چه روشی برای کنترل مهاجرت ماشین‌های مجازی به منظور انتخاب ماشین مجازی مناسب استفاده کنیم؟
\پایان{فقرات}
آنچه در این پایان‌نامه قصد داریم به آن توجه کنیم شامل جای‌دهی مناسب ماشین‌های مجازی به ماشین‌های فیزیکی و مدیریت کردن مهاجرت ماشین‌های مجازی می‌باشد. 
در ادامه به بررسی روش پیشنهاد شده و پارامتر‌های مورد ارزیابی می‌پردازیم.

\قسمت{تجزیه و تحلیل روش پیشنهادی}
سیستم رایانش ابری مورد استفاده در روش پیشنهادی یک محیط سطح
 \lr{IaaS}
 با ماشین‌های فیزیکی متنوع و ناهمگن می‌باشد. در سیستم‌های ابری، چندین کاربر مستقل درخواست‌هایشان را برای
  \lr{N}
  ماشین مجازی ناهمگن که توان پردازشی آنها (بهره پردازنده) در واحد
   \lr{MIPS}\LTRfootnote{Millions Instructions Per Second }
   %LTRfootnote == پانویس
    تعریف می‌شود و همچنین مقدار حافظه و پهنای باند شبکه است، ارسال می‌کنند. به این ترتیب فراهم آورنده‌ی ابر باید بر روی میزان منابع داده شده به ماشین مجازی و بار آن و نیز تغییرات مصرف انرژی ماشین فیزیکی مورد نظر نظارت داشته باشد. 
برای بیان روش خود، درخواست‌ها بر روی ماشین‌های مجازی قرار می‌گیرند. ماشین‌های مجازی به صورت مجموعه
\lr{${VM=\Big( VM_1, VM_2,...,  VM_n\Big)}$}
 درنظر گرفته می‌شوند و این ماشین‌های مجازی بر روی 
\lr{m}
 ماشین فیزیکی به صورت 
 \lr{$PM=\Big( PM_1, PM_2,...,  PM_n\Big)$}
  قرار می‌گیرند. زمانی که ماشین‌های مجازی بر روی ماشین‌های فیزیکی قرار می‌گیرند، بعد از این جای دهی ممکن است یک میزبان با استفاده زیاد از منابع آن دچار اضافه باری شود و نتواند به درخواست کاربر پاسخ دهد و نقض کیفیت سرویس را ایجاد می‌کند. در این کار سعی داریم با جایابی بهینه ماشین‌های مجازی تا جای ممکن از سرریز شدن میزبان‌های فیزیکی جلوگیری کنیم.
  
هدف ما در این پایان نامه ارائه روشی برای کاهش ماشین‌های فیزیکی سرریز شده به منظور جلوگیری از نقض کیفیت خدمات و کاهش توان مصرفی می‌باشد. به منظور جای دهی مناسب ماشین‌های مجازی به ماشین‌های فیزیکی با توجه به منابع مورد نیاز ماشین مجازی و منابع در دسترس میزبان فیزیکی، میزان منابع اختصاص داده شده به ماشین مجازی را تخمین می‌زنیم و هر ماشین مجازی به میزبانی تخصیص می‌دهیم که منابع اختصاص داده شده به آن ماشین مجازی بیشتر از میزبان درخواست شده توسط آن ماشین مجازی باشد. برای این منظور معیاری که در فرمول
(\ref{f1})
 در زیر بیان شده است را مطرح می‌کنیم.
 \begin{equation}
Factor= \frac{VM_{resource\hspace{3pt} requirements}}{PM_{available\hspace{3pt} resource}}
\label{f1}
 \end{equation}
                                                                                


برای هر ماشین فیزیکی این معیار را محاسبه می‌کنیم و میزبانی را به عنوان میزبان مورد نظر برای جای‌دهی ماشین مجازی انتخاب می‌کنیم که کمترین مقدار را در بین دیگر ماشین‌های فیزیکی دارد. علت این انتخاب این است که هرچه مقدار این معیار کمتر باشد نشان دهنده این است که منابع موجود ماشین فیزیکی نسبت به منابع مورد نیاز ماشین مجازی بیشتر است و احتمال کمتری وجود دارد که آن میزبان دچار سرریزی شود. 

\قسمت{ روش ترکیب ماشین‌های مجازی }

بعد از اینکه ماشین‌های مجازی به ماشین فیزیکی مناسب تخصیص داده می‌شود، مسئله‌ی ترکیب پویای ماشین‌های مجازی به منظور استفاده بهینه از منابع و بهبود کیفیت سرویس به ۳ بخش تقسیم می‌شود که شامل شناسایی میزبان‌های فیزیکی که به عنوان پربار در نظر گرفته می‌شوند که نیاز به مهاجرت یک یا چند ماشین مجازی از این میزبان فیزیکی برای جلوگیری از نقض کیفیت خدمات می‌باشد. در مرحله بعد انتخاب ماشین مجازی از ماشین فیزیکی سرریز شده می‌باشد تا از نقض کیفیت سرویس جلوگیری شود.گام بعدی شناسایی زمانی که یک میزبان فیزیکی به عنوان کم‌بار
\lr{\LTRfootnote{Under load}}
 در‌نظر گرفته می‌شود که نیاز به مهاجرت همه‌ی ماشین‌های مجازی از این ماشین فیزیکی دارد و تغییر حالت ماشین فیزیکی به حالت خاموش است (چین ۲۰۱۶، ۶۲:۷۱ و پاتل ۲۰۱۵)
%\cite{num9,num15}
.همچنین ما قصد داریم کنترلی در سیاست انتخاب ماشین مجازی از ماشین فیزیکی پربار اعمال کنیم. برای این منظور، بعد از اینکه ماشین‌های مجازی به ماشین فیزیکی مناسب تخصیص داده می‌شود ممکن است باز هم میزبانی وجود داشته باشد که دچار اضافه باری شود. براساس مقاله  (چین ۲۰۱۶، ۶۲:۷۱ و پاتل ۲۰۱۵)
%\cite{num9,num15}
 از حد آستانه بالا
\lr{\LTRfootnote{Upper threshold}}
  برای شناسایی ماشین‌های سرریز شده استفاده می‌کنیم. 

این حد آستانه به صورت پویا براساس بار قرار گرفته روی هر میزبان تعریف می‌شود. زمانی که یک میزبان دچار اضافه‌بار می‌شود نیاز است یک یا تعدادی از ماشین‌های مجازی آن میزبان به منظور جلوگیری از نقض کیفیت خدمات کاربر مهاجرت داده شود. در مقاله پاتل
%\cite{num15}
سه سیاست برای انتخاب ماشین مجازی از ماشین فیزیکی سرریز شده ارائه شده است. روش اول  
\lr{MU}
یا حداقل بهره پردازنده، که در این روش ماشین مجازی برای مهاجرت از میزبان سرریز شده انتخاب می‌شود که دارای حداقل استفاده از پردازنده است. روش دوم روش تصادفی است که یک ماشین مجازی به صورت تصادفی انتخاب می‌شود. روش بعدی برای مهاجرت ماشین‌های مجازی، روش زمان مهاجرت حداقل
\lr{(MMT)\LTRfootnote{Minimum Migration Time}}
نام دارد. در این روش یک ماشین مجازی که مقدار حافظه به پهنای باند کمتری را دارد را برای مهاجرت انتخاب می‌کند. فرمول
(\ref{f2})
 این سیاست را بیان می‌کند (پاتل ۲۰۱۵) :
%\cite{num15}
\begin{equation}
v\in V_j|\forall a \in V_j, \frac{RAM_u(v)}{NET_j} \leq \frac{RAM_u(a)}{NET_j}
\label{f2}
\end{equation}
زمان مهاجرت با مقدار
 \lr{RAM} 
استفاده شده
 \lr{VM} 
تقسیم بر پهنای باند شبکه در دسترس برای ماشین فیزیکی
 \lr{j}
  برآورد می‌شود. یک مجموعه از
   \lr{VM} 
 ‌های است که اخیراً به میزبان فیزیکی j  تخصیص یافته است.  مقدار 
   \lr{RAM} 
  استفاده شده اخیر توسط
\lr{$VM_a$}
   است.  پهنای باند شبکه در دسترس برای میزبان فیزیکی 
   \lr{j}
    است.
ما سعی داریم تغییری در این سیاست‌ها اعمال کنیم تا بتوانیم در انتخاب ماشین مجازی مناسب موثرتر واقع شویم. اگر چندین ماشین مجازی مقدار حافظه یکسان داشته باشند در روش 
\lr{MMT}

 فاکتوری را برای این حالت در نظر نگرفته است. ما قصد داریم زمانی که این حالت اتفاق افتاد ماشین مجازی که استفاده از پردازنده بیشتری دارد را برای مهاجرت انتخاب کنیم. زیرا با این انتخاب آن میزبان فیزیکی احتمال بیشتری دارد که از حالت اضافه باری خارج شود. همچنین در حالت
  \lr{MU} 
 اگر چند ماشین مجازی دارای بهره پردازنده یکسان بودند آن ماشین مجازی را انتخاب کنیم که حداقل مقدار حافظه را دارد تا زمان مهاجرت را حداقل کرده و از نقض کیفیت سرویس جلوگیری کنیم.
برای شناسایی میزبان‌های فیزیکی با بار کمتر از حد نرمال، طبق روش پاتل
%\cite{num15}
ماشین فیزیکی که نسبت به دیگر ماشین‌های فیزیکی از منابع خود کمتر استفاده می‌کند به عنوان کم بار در نظر گرفته می‌شود. در نهایت برای قرار دادن ماشین‌های مجازی از این ماشین فیزیکی روی ماشین ‌های فیزیکی دیگر تلاش می‌کند و ماشین فیزیکی مبدأ زمانی که همه‌ی ماشین‌های مجازی مهاجرت داده شد به حالت خواب تغییر پیدا می‌کند.
\قسمت{بدست آورن میزان انرژی مصرفی }
برای بدست آوردن میزان انرژی استفاده شده توسط ماشین‌های فیزیکی از  فرمول ارائه شده در روش پاتل  
%\cite{num15}
استفاده می‌کنیم­. طبق آزمایشات انجام شده ، بهره‌وری و استفاده از پردازنده در مقایسه با دیگر منابع یک ماشین فیزیکی انرژی مصرف می‌کند. برای این منظور فرمولی که برای محاسبه انرژی مصرفی ماشین فیزیکی بیان شده است براساس بهره وری و استفاده از پردازنده می‌باشد. فرمول
(\ref{f3})
 در رابطه زیر، فرمول انرژی را بیان می‌کند­:(پاتل ۲۰۱۵)
%\cite{num15}
\begin{equation}
E=\int_{t_0}^{t_1}P\Big(u(t)\Big)\:\mathrm{d}t
\label{f3}
\end{equation}
 
طبق فرمول بالا، از آنجا  که استفاده از پردازنده ممکن است با گذشت زمان به علت تغییرپذیری بار کاری­، تغییر کند­، از این‌رو، بهره وری پردازنده تابعی از زمان است و به عنوان 
\lr{ u(t)}
ارائه می­شود­.
\lr{E}
 به صورت انتگرال تابع مصرف انرژی روی یک دوره زمانی تعریف می‌شود که در رابطه بالا نمایش داده شده است. در روش پیشنهادی طبق فرمول بالا به محاسبه مصرف توان ماشین‌های فیزیکی و سپس مصرف انرژی آنها به صورت منفرد محاسبه شده و به صورت زیر مجموع مصرف انرژی ابر را محاسبه می‌کنیم: (پاتل ۲۰۱۵)
%\cite{num15}
\begin{equation}
ET_t = \sum_{i=1}^{n}\:Ei
\label{f4}
\end{equation}

طبق فرمول بالا،
 \lr{n}
 تعداد کل ماشین‌های فیزیکی­،
  \lr{Ei}
  انرژی مصرف‌شده توسط میزبان 
  \lr{i}
   ام تا زمان
   \lr{t }
   ,
\lr{    ETt }
  مجموع کل انرژی مصرفی ابر در زمان
   \lr{t} 
   است­.
\قسمت{    بدست آوردن میزان نقض کیفیت سرویس }
   کیفیت سرویس بحث مهمی‌در زمینه سیستم‌های ابری است. نقض شدن کیفیت درخواست شده از طرف کاربر برای فراهم آورنده‌ی ابر بسیار نامطلوب خواهد بود. به این دلیل که باید در مقابل کیفیت سرویس نقض شده جریمه‌های مالی پرداخت شود. کیفیت سرویس در محیط ابر معمولاً به فرم
    \lr{SLA} 
   (توافق نامه سطح خدمات)شناخته می‌شوند. از آنجایی که بر روی یک ماشین فیزیکی بیش از ظرفیت آن ماشین مجازی قرار داده‌ شده ‌است، پارامتری که می‌تواند مورد نظارت قرار‌گیرد، میزان مصرف منابع آن ماشین فیزیکی می‌باشد. 
   در محیط ابری عواملی مثل مهاجرت و سربار شدن میزبان‌های فیزیکی باعث نقض خدمات می‌شود. برای این منظور از دو پارامتر طبق فرمول ارائه شده در روش‌های پاتل و بلوگلازوو 
%\cite{num15, num16}
   برای محاسبه نقض کیفیت خدمات استفاده می‌کنیم. این دو پارامتر شامل :
   زمان نقض
    \lr{SLA}
   هر میزبان
\lr{   (SLATAH) }
   زمانی که میزبان‌ها از تمام بهره خود استفاده می‌کنند که باعث نقض خدمات می‌شود.فرمول
\ref{f5}
    برای این منظور در زیر بیان شده است:(بلگلازوو \پانویس{
    \lr{Beloglazov}} ۲۰۱۳، ۱۳۹۷:۱۴۲۰)
%\cite{num16}
\begin{equation}
SLATAH=\frac{1}{N}\:\sum_{i=1}^{N}\:\frac{T_{si}}{T_{ai}}
\label{f5}
\end{equation}
   
      \lr{N} 
   تعداد ماشین‌های فیزیکی،
   \lr{$T_{si}$}
      زمان کل در طولی که ماشین فیزیکی 
   \lr{i}
    از تمام بهره خود استفاده می‌کند که نقض کیفیت خدمات را ایجاد می‌کند. 
    \lr{$T_{ai}$}
      زمان کل ماشین فیزیکی 
    \lr{i} 
    که در حالت فعال است. 
   پارامتر بعدی کاهش کارایی کل با مهاجرت ماشین‌های مجازی
\lr{   (PDM) }
   است که مربوط به زمانی است که مهاجرتی صورت می‌گیرید که باعث نقض کارایی می‌شود: 
(تانی و عمرانی
\پانویس{
\lr{Tani \& & El Amrani}} ۲۰۱۶، ۱۸۶۶)
%\cite{num16}

\begin{equation}
PDM = \frac{1}{M}\:\sum_{j=1}^{m}\:\frac{C_{dj}}{C_{rj}}
\label{f6}
\end{equation}
   \lr{M} 
   تعداد
    \lr{VM} 
  ‌ها، 
   \lr{$C_{dj}$}
    نقض کارایی 
\lr{$VM_j$ }
    که با مهاجرت ایجاد می‌شود را برآورد می‌کند.
         \lr{$C_{rj}$}
    کل ظرفیت پردازنده درخواست شده 
    توسط
\lr{$VM_j$}
          در طول دوره زندگی آن است.در آزمایشات 
     \lr{$C_{dj}$}
      با 
      ۱۰\%
        از بهره پردازنده در
\lr{      MIPS }
     در طول مهاجرت همه‌ی
\lr{$VM_j$}
     برآورد شده است.
     
   این دو معیار هر دو در نقض کیفیت سرویس موثر هستند.هم زمانی که یک ماشین فیزیکی دچار اضافه باری می‌شود و هم زمانی که مهاجرتی صورت می‌گیرد. برای این منظور از یک معیار ترکیبی که شامل هر دو معیار است استفاده می‌شود(بلوگرلازوو ۲۰۱۵)
%   \cite{num16}.

\begin{equation}
   SLAV = SLATAH.PDM
\end{equation}
   
   در این فصل روش پیشنهادی به طور کامل شرح داده شد. در فصل بعدی پارامترهای ارزیابی تعریف می­شود و روش پیشنهادی به کمک آنها مورد ارزیابی قرار می‌گیرد.
